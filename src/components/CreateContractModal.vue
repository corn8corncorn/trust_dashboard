<template>
  <Modal
    v-model="visible"
    title="Â•ëÁ¥ÑÂª∫Ê™î"
    :mask-closable="false"
    width="1400"
    :styles="{ top: '20px' }"
    class-name="create-contract-modal"
    @on-cancel="handleCancel"
  >
    <div class="contract-form-container">
      <Form
        ref="contractForm"
        :model="formData"
        :label-width="140"
        :rules="rules"
      >
        <!-- üìò Â•ëÁ¥ÑÂª∫Ê™î -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üìò Â•ëÁ¥ÑÂª∫Ê™î</div>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*Â•ëÁ¥ÑÁ∑®Ëôü" prop="contractNo">
                <Row :gutter="8">
                  <Col span="8">
                    <Select
                      v-model="formData.contractNoPrefix1"
                      placeholder="F103"
                    >
                      <Option value="F103">F103</Option>
                    </Select>
                  </Col>
                  <Col span="8">
                    <Select
                      v-model="formData.contractNoPrefix2"
                      placeholder="ÊãõÊî¨ÂñÆ‰Ωç"
                    >
                      <Option value="A">A</Option>
                    </Select>
                  </Col>
                  <Col span="8">
                    <Input
                      v-model="formData.contractNoSuffix"
                      placeholder="Ëº∏ÂÖ•Á∑®Ëôü"
                      clearable
                    />
                  </Col>
                </Row>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÊãõÊî¨ÈÉ®ÈñÄ">
                <Input
                  v-model="formData.department"
                  disabled
                  placeholder="Á≥ªÁµ±‰ª£Âá∫"
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*Êé®Ëñ¶‰∫∫Ë∫´ÂàÜ" prop="referrerIdentity">
                <Select
                  v-model="formData.referrerIdentity"
                  placeholder="Ë∫´ÂàÜÂà•"
                >
                  <Option value="identity1">Ë∫´ÂàÜÂà•1</Option>
                </Select>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="*Êé®Ëñ¶‰∫∫" prop="referrer">
                <Input
                  v-model="formData.referrer"
                  placeholder="Âì°Á∑®-ÂßìÂêç"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*Á∂ìËæ¶‰∫∫Ë∫´ÂàÜ" prop="handlerIdentity">
                <Select v-model="formData.handlerIdentity" placeholder="Ë∫´ÂàÜÂà•">
                  <Option value="identity1">Ë∫´ÂàÜÂà•1</Option>
                </Select>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="*Á∂ìËæ¶‰∫∫" prop="handler">
                <Input
                  v-model="formData.handler"
                  placeholder="Âì°Á∑®-ÂßìÂêç"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*‰ø°Ë®óÈÉ®ÊâøËæ¶‰∫∫Âì°" prop="trustHandler">
                <Select v-model="formData.trustHandler" placeholder="Âì°Á∑®-ÂßìÂêç">
                  <Option value="staff1">Âì°Á∑®-ÂßìÂêç1</Option>
                </Select>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="*Â•ëÁ¥ÑÊ°àÂêç" prop="caseName">
                <Input
                  v-model="formData.caseName"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*Ê•≠ÂãôÈ°ûÂà•" prop="businessType">
                <Select
                  v-model="formData.businessType"
                  placeholder="‰∏çÂãïÁî¢ÈñãÁôº"
                >
                  <Option value="realestate">‰∏çÂãïÁî¢ÈñãÁôº</Option>
                </Select>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÂÆπÁ©çÁßªËΩâÂª∫ÁØâÁâ©">
                <Select
                  v-model="formData.buildingType"
                  placeholder="Ê≠∑Âè≤ÊÄßÂª∫ÁØâÁâ©"
                >
                  <Option value="historic">Ê≠∑Âè≤ÊÄßÂª∫ÁØâÁâ©</Option>
                </Select>
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="Ê°à‰ª∂ÈáëÈ°ç">
                <Input
                  v-model="formData.caseAmount"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="*Á∞ΩÁ¥ÑÊó•" prop="contractDate">
                <DatePicker
                  v-model="formData.contractDate"
                  type="date"
                  placeholder="ÈÅ∏ÂèñÊó•Êúü"
                  clearable
                  style="width: 100%"
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÁµêÊ°àÊó•">
                <DatePicker
                  v-model="formData.closeDate"
                  type="date"
                  placeholder="ÈÅ∏ÂèñÊó•Êúü"
                  clearable
                  style="width: 100%"
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="‰ø°Ë®óÂ∏≥Ëôü">
                <Row :gutter="8">
                  <Col span="4">
                    <Select
                      v-model="formData.trustAccountType"
                      placeholder="+/-"
                    >
                      <Option value="+">+</Option>
                      <Option value="-">-</Option>
                    </Select>
                  </Col>
                  <Col span="20">
                    <Input
                      v-model="formData.trustAccount"
                      placeholder="Â∏≥Ëôü"
                      clearable
                    />
                  </Col>
                </Row>
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="*Â≠òÁ∫åÊúüÈñì" prop="duration">
                <Row :gutter="8">
                  <Col span="11">
                    <DatePicker
                      v-model="formData.durationStart"
                      type="date"
                      placeholder="ÈÅ∏ÂèñÊó•Êúü"
                      clearable
                      style="width: 100%"
                    />
                  </Col>
                  <Col span="2" style="text-align: center; line-height: 32px"
                    >~</Col
                  >
                  <Col span="11">
                    <DatePicker
                      v-model="formData.durationEnd"
                      type="date"
                      placeholder="ÈÅ∏ÂèñÊó•Êúü"
                      clearable
                      style="width: 100%"
                    />
                  </Col>
                </Row>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="*‰ø°Ë®óÁôªË®òÊó•" prop="trustRegDate">
                <DatePicker
                  v-model="formData.trustRegDate"
                  type="date"
                  placeholder="ÈÅ∏ÂèñÊó•Êúü"
                  clearable
                  style="width: 100%"
                />
              </FormItem>
            </Col>
          </Row>

          <Row :gutter="16">
            <Col span="12">
              <FormItem label="‰ø°Ë®óÂ°óÈä∑Êó•">
                <DatePicker
                  v-model="formData.trustCancelDate"
                  type="date"
                  placeholder="ÈÅ∏ÂèñÊó•Êúü"
                  clearable
                  style="width: 100%"
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="Â°óÈä∑ÂéüÂõ†">
                <Select
                  v-model="formData.cancelReason"
                  placeholder="‰ø°Ë®óÁõÆÁöÑÂÆåÊàê"
                >
                  <Option value="completed">‰ø°Ë®óÁõÆÁöÑÂÆåÊàê</Option>
                </Select>
              </FormItem>
            </Col>
          </Row>

          <Row>
            <Col span="24">
              <FormItem label="‰ø°Ë®óË≤°Áî¢ËøîÈÇÑÊòéÁ¥∞">
                <Row :gutter="8">
                  <Col span="6">
                    <div style="display: flex; align-items: center; gap: 8px">
                      <span>ÈäÄË°å</span>
                      <Input
                        v-model="formData.returnBankName"
                        placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                        clearable
                        style="flex: 1"
                      />
                    </div>
                  </Col>
                  <Col span="6">
                    <div style="display: flex; align-items: center; gap: 8px">
                      <span>ÂàÜË°å</span>
                      <Input
                        v-model="formData.returnBranchName"
                        placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                        clearable
                        style="flex: 1"
                      />
                    </div>
                  </Col>
                  <Col span="6">
                    <div style="display: flex; align-items: center; gap: 8px">
                      <span>Â∏≥Ëôü</span>
                      <Input
                        v-model="formData.returnAccountNo"
                        placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                        clearable
                        style="flex: 1"
                      />
                    </div>
                  </Col>
                </Row>
              </FormItem>
            </Col>
          </Row>
        </Card>

        <!-- üü¶ ÂßîË®ó‰∫∫Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üü¶ ÂßîË®ó‰∫∫Ë≥áÊñô</div>
          <Table
            :columns="clientColumns"
            :data="formData.clients"
            border
            :scroll="{ x: 1500 }"
          >
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editClient(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeClient(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button
            type="dashed"
            long
            style="margin-top: 10px"
            :loading="loading"
            @click="addClient"
            >+</Button
          >
        </Card>

        <!-- üüß ‰ø°Ë®óÈóú‰øÇ‰∫∫Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üüß ‰ø°Ë®óÈóú‰øÇ‰∫∫Ë≥áÊñô</div>
          <Table
            :columns="trusteeRelationColumns"
            :data="formData.trusteeRelations"
            border
          >
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editTrusteeRelation(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeTrusteeRelation(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button
            type="dashed"
            long
            style="margin-top: 10px"
            :loading="loading"
            @click="addTrusteeRelation"
            >+</Button
          >
        </Card>

        <!-- üü® ÂèóË®ó‰∫∫Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üü® ÂèóË®ó‰∫∫Ë≥áÊñô</div>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÂèóË®ó‰∫∫">
                <Input
                  v-model="formData.trustee"
                  disabled
                  value="‚óã‚óãÂïÜÊ•≠ÈäÄË°åËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏"
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="È°ûÂà•">
                <Select v-model="formData.trusteeType" placeholder="‰πôÊñπ">
                  <Option value="partyB">‰πôÊñπ</Option>
                </Select>
              </FormItem>
            </Col>
          </Row>
          <Row>
            <Col span="12">
              <FormItem label="‰ø°Ë®óÁ®ÆÈ°û">
                <Select v-model="formData.trustType" placeholder="Ëá™Áõä‰ø°Ë®ó">
                  <Option value="self">Ëá™Áõä‰ø°Ë®ó</Option>
                </Select>
              </FormItem>
            </Col>
          </Row>

          <div style="margin-top: 20px">
            <h4>ÂèóË®ó‰∫∫ÊòéÁ¥∞</h4>
            <Table
              :columns="trusteeDetailColumns"
              :data="formData.trusteeDetails"
              border
            >
              <template slot-scope="{ row, index }" slot="action">
                <div style="display: flex; gap: 8px; justify-content: center">
                  <Tooltip content="‰øÆÊîπ" transfer>
                    <Button
                      type="warning"
                      size="small"
                      :loading="loading"
                      @click="editTrusteeDetail(index)"
                    >
                      <Icon type="ios-create-outline" />
                    </Button>
                  </Tooltip>
                  <Tooltip content="Âà™Èô§" transfer>
                    <Button
                      type="error"
                      size="small"
                      :loading="loading"
                      @click="removeTrusteeDetail(index)"
                    >
                      <Icon type="ios-trash-outline" />
                    </Button>
                  </Tooltip>
                </div>
              </template>
            </Table>
            <Button
              type="dashed"
              long
              style="margin-top: 10px"
              @click="addTrusteeDetail"
              >+</Button
            >
          </div>
        </Card>

        <!-- üü© ÂèóÁõä‰∫∫Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üü© ÂèóÁõä‰∫∫Ë≥áÊñô</div>
          <Table
            :columns="beneficiaryColumns"
            :data="formData.beneficiaries"
            border
          >
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editBeneficiary(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeBeneficiary(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button
            type="dashed"
            long
            style="margin-top: 10px"
            :loading="loading"
            @click="addBeneficiary"
            >+</Button
          >
        </Card>

        <!-- üü´ ÂúüÂú∞Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üü´ ÂúüÂú∞Ë≥áÊñô</div>
          <Table :columns="landColumns" :data="formData.lands" border>
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editLand(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeLand(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button type="dashed" long style="margin-top: 10px" @click="addLand"
            >+</Button
          >
        </Card>

        <!-- ‚¨ú Âª∫Áâ©Ë≥áÊñô -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">‚¨ú Âª∫Áâ©Ë≥áÊñô</div>
          <Table :columns="buildingColumns" :data="formData.buildings" border>
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editBuilding(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeBuilding(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button
            type="dashed"
            long
            style="margin-top: 10px"
            :loading="loading"
            @click="addBuilding"
            >+</Button
          >
          <Row :gutter="16" style="margin-top: 16px">
            <Col span="12">
              <FormItem label="ÂÇôË®ª">
                <Input
                  v-model="formData.remark"
                  type="textarea"
                  :rows="3"
                  clearable
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="Êú¨ÈáëÂúüÂú∞">
                <Input
                  v-model="formData.principalLand"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°äÔºàÂÖà‰∫∫Â∑•ÈçµÂÖ•Ôºå‰πãÂæå‰ª•‰∏≠Ëè≤‰ª£ÂÖ•Ôºâ"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>
        </Card>

        <!-- üí∞ ‰ø°Ë®óÊâãÁ∫åË≤ª -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üí∞ ‰ø°Ë®óÊâãÁ∫åË≤ª</div>
          <Table :columns="feeColumns" :data="formData.fees" border>
            <template slot-scope="{ row, index }" slot="action">
              <div style="display: flex; gap: 8px; justify-content: center">
                <Tooltip content="‰øÆÊîπ" transfer>
                  <Button
                    type="warning"
                    size="small"
                    :loading="loading"
                    @click="editFee(index)"
                  >
                    <Icon type="ios-create-outline" />
                  </Button>
                </Tooltip>
                <Tooltip content="Âà™Èô§" transfer>
                  <Button
                    type="error"
                    size="small"
                    :loading="loading"
                    @click="removeFee(index)"
                  >
                    <Icon type="ios-trash-outline" />
                  </Button>
                </Tooltip>
              </div>
            </template>
          </Table>
          <Button type="dashed" long style="margin-top: 10px" @click="addFee"
            >+</Button
          >
          <Row style="margin-top: 16px">
            <Col span="12">
              <FormItem label="ÊîØ‰ªòÊñπ">
                <Select v-model="formData.payer" placeholder="01-Áî≤Êñπ">
                  <Option value="partyA">01-Áî≤Êñπ</Option>
                </Select>
              </FormItem>
            </Col>
          </Row>
        </Card>

        <!-- üìÑ ÊâÄÈúÄÁöÑÊáâÂÇôÊñá‰ª∂ÈÅ∏Âèñ -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üìÑ ÊâÄÈúÄÁöÑÊáâÂÇôÊñá‰ª∂ÈÅ∏Âèñ</div>
          <CheckboxGroup v-model="formData.requiredDocs">
            <Row>
              <Col span="8">
                <Checkbox label="01">01-ÂÖ¨Âè∏ËÆäÊõ¥ÁôªË®òÂΩ±Êú¨</Checkbox>
              </Col>
              <Col span="8">
                <Checkbox label="02">02-Ë≤†Ë≤¨‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨</Checkbox>
              </Col>
              <Col span="8">
                <Checkbox label="03">03-Âç∞ÈëëÂç°</Checkbox>
              </Col>
            </Row>
            <Row style="margin-top: 10px">
              <Col span="8">
                <Checkbox label="04">04-ÂßîË®ó‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨</Checkbox>
              </Col>
              <Col span="8">
                <Checkbox label="05">05-‰ª£ÁêÜ‰∫∫Ë∫´ÂàÜË≠âÂΩ±Êú¨</Checkbox>
              </Col>
              <Col span="8">
                <Checkbox label="06">06-ÊéàÊ¨äÊõ∏</Checkbox>
              </Col>
            </Row>
          </CheckboxGroup>
        </Card>

        <!-- üéØ ÂÖßÈÉ®ÂàÜÊΩ§ -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üéØ ÂÖßÈÉ®ÂàÜÊΩ§</div>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÂàÜÊΩ§ÊØîÁéá">
                <Input
                  v-model="formData.internalProfitRate"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
                <span style="margin-left: 8px">%</span>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÂàÜÊΩ§ÁçéÈáë">
                <Input
                  v-model="formData.internalProfitBonus"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>
        </Card>

        <!-- üéØ Â§ñÈÉ®ÂàÜÊΩ§ -->
        <Card class="form-section" :bordered="false">
          <div slot="title" class="section-title">üéØ Â§ñÈÉ®ÂàÜÊΩ§</div>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÂàÜÊΩ§Â∞çË±°">
                <Select
                  v-model="formData.externalProfitTarget"
                  placeholder="00ÁÑ°"
                >
                  <Option value="none">00ÁÑ°</Option>
                </Select>
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÂàÜÊΩ§ÊØîÁéá">
                <div style="display: flex; align-items: center; gap: 8px">
                  <Input
                    v-model="formData.externalProfitRate"
                    placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                    clearable
                    style="flex: 1"
                  />
                  <span>%</span>
                </div>
              </FormItem>
            </Col>
          </Row>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÂàÜÊΩ§ÁçéÈáë">
                <Input
                  v-model="formData.externalProfitBonus"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÂßìÂêç">
                <div style="display: flex; align-items: center; gap: 8px">
                  <Input
                    v-model="formData.externalProfitName"
                    placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                    clearable
                    style="flex: 1"
                  />
                  <Tooltip content="Êü•Ë©¢" transfer>
                    <Button
                      type="primary"
                      :loading="loading"
                      @click="queryExternalProfitName"
                    >
                      <Icon type="ios-search" />
                    </Button>
                  </Tooltip>
                </div>
              </FormItem>
            </Col>
          </Row>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="Êà∂Âêç">
                <Input
                  v-model="formData.externalProfitAccountName"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÂàÜË°åÂêçÁ®±">
                <Input
                  v-model="formData.externalProfitBranchName"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>
          <Row :gutter="16">
            <Col span="12">
              <FormItem label="ÈäÄË°åÂêçÁ®±">
                <Input
                  v-model="formData.externalProfitBankName"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
            <Col span="12">
              <FormItem label="ÈäÄË°åÂ∏≥Ëôü">
                <Input
                  v-model="formData.externalProfitBankAccount"
                  placeholder="Ëº∏ÂÖ•ÊñπÂ°ä"
                  clearable
                />
              </FormItem>
            </Col>
          </Row>
        </Card>
      </Form>
    </div>

    <div slot="footer">
      <Button :loading="loading" @click="handleCancel">ÂèñÊ∂à</Button>
      <Button type="primary" :loading="loading" @click="handleSubmit"
        >ÂÑ≤Â≠ò</Button
      >
    </div>
  </Modal>
</template>

<script>
export default {
  name: "CreateContractModal",
  props: {
    value: {
      type: Boolean,
      default: false,
    },
  },
  data() {
    return {
      visible: this.value,
      loading: false,
      formData: {
        // Â•ëÁ¥ÑÂª∫Ê™î
        contractNoPrefix1: "",
        contractNoPrefix2: "",
        contractNoSuffix: "",
        department: "",
        referrerIdentity: "",
        referrer: "",
        handlerIdentity: "",
        handler: "",
        trustHandler: "",
        caseName: "",
        businessType: "",
        buildingType: "",
        caseAmount: "",
        contractDate: "",
        closeDate: "",
        trustAccountType: "+",
        trustAccount: "",
        durationStart: "",
        durationEnd: "",
        trustRegDate: "",
        trustCancelDate: "",
        cancelReason: "",
        returnBank: false,
        returnBankName: "",
        returnBranch: false,
        returnBranchName: "",
        returnAccount: false,
        returnAccountNo: "",
        // ÂßîË®ó‰∫∫Ë≥áÊñô
        clients: [],
        // ‰ø°Ë®óÈóú‰øÇ‰∫∫Ë≥áÊñô
        trusteeRelations: [],
        // ÂèóË®ó‰∫∫Ë≥áÊñô
        trustee: "‚óã‚óãÂïÜÊ•≠ÈäÄË°åËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏",
        trusteeType: "",
        trustType: "",
        trusteeDetails: [],
        // ÂèóÁõä‰∫∫Ë≥áÊñô
        beneficiaries: [],
        // ÂúüÂú∞Ë≥áÊñô
        lands: [],
        // Âª∫Áâ©Ë≥áÊñô
        buildings: [],
        remark: "",
        principalLand: "",
        // ‰ø°Ë®óÊâãÁ∫åË≤ª
        fees: [],
        payer: "",
        // ÊáâÂÇôÊñá‰ª∂
        requiredDocs: [],
        // ÂÖßÈÉ®ÂàÜÊΩ§
        internalProfitRate: "",
        internalProfitBonus: "",
        // Â§ñÈÉ®ÂàÜÊΩ§
        externalProfitTarget: "",
        externalProfitRate: "",
        externalProfitBonus: "",
        externalProfitName: "",
        externalProfitAccountName: "",
        externalProfitBranchName: "",
        externalProfitBankName: "",
        externalProfitBankAccount: "",
      },
      rules: {
        contractNoSuffix: [
          { required: true, message: "Ë´ãËº∏ÂÖ•Â•ëÁ¥ÑÁ∑®Ëôü", trigger: "blur" },
        ],
        referrerIdentity: [
          { required: true, message: "Ë´ãÈÅ∏ÊìáÊé®Ëñ¶‰∫∫Ë∫´ÂàÜ", trigger: "change" },
        ],
        referrer: [
          { required: true, message: "Ë´ãËº∏ÂÖ•Êé®Ëñ¶‰∫∫", trigger: "blur" },
        ],
        handlerIdentity: [
          { required: true, message: "Ë´ãÈÅ∏ÊìáÁ∂ìËæ¶‰∫∫Ë∫´ÂàÜ", trigger: "change" },
        ],
        handler: [{ required: true, message: "Ë´ãËº∏ÂÖ•Á∂ìËæ¶‰∫∫", trigger: "blur" }],
        trustHandler: [
          {
            required: true,
            message: "Ë´ãÈÅ∏Êìá‰ø°Ë®óÈÉ®ÊâøËæ¶‰∫∫Âì°",
            trigger: "change",
          },
        ],
        caseName: [
          { required: true, message: "Ë´ãËº∏ÂÖ•Â•ëÁ¥ÑÊ°àÂêç", trigger: "blur" },
        ],
        businessType: [
          { required: true, message: "Ë´ãÈÅ∏ÊìáÊ•≠ÂãôÈ°ûÂà•", trigger: "change" },
        ],
        contractDate: [
          {
            required: true,
            message: "Ë´ãÈÅ∏ÊìáÁ∞ΩÁ¥ÑÊó•",
            trigger: "change",
            type: "date",
          },
        ],
        durationStart: [
          {
            required: true,
            message: "Ë´ãÈÅ∏ÊìáÂ≠òÁ∫åÊúüÈñìËµ∑Êó•",
            trigger: "change",
            type: "date",
          },
        ],
        durationEnd: [
          {
            required: true,
            message: "Ë´ãÈÅ∏ÊìáÂ≠òÁ∫åÊúüÈñìËøÑÊó•",
            trigger: "change",
            type: "date",
          },
        ],
        trustRegDate: [
          {
            required: true,
            message: "Ë´ãÈÅ∏Êìá‰ø°Ë®óÁôªË®òÊó•",
            trigger: "change",
            type: "date",
          },
        ],
      },
      // Ë°®Ê†ºÊ¨Ñ‰ΩçÂÆöÁæ©
      clientColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "Á∞°Á®±",
          key: "shortName",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h(
              "Select",
              {
                props: {
                  value: params.row.shortName,
                  placeholder: "Ë´ãÈÅ∏Âèñ",
                  transfer: true,
                },
                style: { width: "100%" },
                on: {
                  "on-change": (val) => {
                    params.row.shortName = val;
                  },
                },
              },
              [
                h("Option", { props: { value: "partyA" } }, "Áî≤Êñπ"),
                h("Option", { props: { value: "partyB" } }, "‰πôÊñπ"),
                h("Option", { props: { value: "partyC" } }, "‰∏ôÊñπ"),
              ]
            );
          },
        },
        {
          title: "Ë∫´ÂàÜ",
          key: "identity",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "Select",
              {
                props: {
                  value: params.row.identity,
                  placeholder: "Ë´ãÈÅ∏Âèñ",
                  transfer: true,
                },
                style: { width: "100%" },
                on: {
                  "on-change": (val) => {
                    params.row.identity = val;
                  },
                },
              },
              [
                h("Option", { props: { value: "landlord" } }, "Âú∞‰∏ª"),
                h("Option", { props: { value: "owner" } }, "ÊâÄÊúâÊ¨ä‰∫∫"),
                h("Option", { props: { value: "agent" } }, "‰ª£ÁêÜ‰∫∫"),
                h("Option", { props: { value: "other" } }, "ÂÖ∂‰ªñ"),
              ]
            );
          },
        },
        {
          title: "Ë∫´ÂàÜË≠âÂ≠óËôü",
          key: "idNumber",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: {
                value: params.row.idNumber,
                placeholder: "Ë´ãËº∏ÂÖ•Ë∫´ÂàÜË≠âÂ≠óËôü",
                clearable: true,
              },
              on: {
                input: (val) => {
                  params.row.idNumber = val;
                },
              },
            });
          },
        },
        {
          title: "ÂßîË®ó‰∫∫",
          key: "clientName",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.clientName,
                    placeholder: "Ë´ãËº∏ÂÖ•ÂßîË®ó‰∫∫",
                    clearable: true,
                  },
                  style: { flex: 1 },
                  on: {
                    input: (val) => {
                      params.row.clientName = val;
                    },
                  },
                }),
                h(
                  "Tooltip",
                  {
                    props: {
                      content: "Êü•Ë©¢",
                      transfer: true,
                    },
                  },
                  [
                    h("Button", {
                      props: {
                        type: "primary",
                        size: "small",
                        icon: "ios-search",
                        loading: this.loading,
                      },
                      style: { marginLeft: "8px" },
                      on: {
                        click: () => {
                          this.queryClient(params.index);
                        },
                      },
                    }),
                  ]
                ),
              ]
            );
          },
        },
        {
          title: "‰ª£Ë°®‰∫∫",
          key: "representative",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.representative, clearable: true },
              on: {
                input: (val) => {
                  params.row.representative = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∏Ä",
          key: "phone1",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone1, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone1 = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∫å",
          key: "phone2",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone2, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone2 = val;
                },
              },
            });
          },
        },
        {
          title: "Êà∂Á±çÂú∞ÂùÄ",
          key: "registeredAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.registeredAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.registeredAddress = val;
                },
              },
            });
          },
        },
        {
          title: "ÈÄöË®äÂú∞ÂùÄ",
          key: "mailingAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.mailingAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.mailingAddress = val;
                },
              },
            });
          },
        },
        {
          title: "ÂèóÁõä‰∫∫",
          key: "isBeneficiary",
          width: 100,
          align: "center",
          render: (h, params) => {
            return h("Checkbox", {
              props: { value: params.row.isBeneficiary },
              on: {
                "on-change": (val) => {
                  params.row.isBeneficiary = val;
                },
              },
            });
          },
        },
      ],
      trusteeRelationColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "Áµ±‰∏ÄÁ∑®Ëôü",
          key: "taxId",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.taxId,
                    clearable: true,
                  },
                  style: { flex: 1 },
                  on: {
                    input: (val) => {
                      params.row.taxId = val;
                    },
                  },
                }),
                h(
                  "Tooltip",
                  {
                    props: {
                      content: "Êü•Ë©¢",
                      transfer: true,
                    },
                  },
                  [
                    h("Button", {
                      props: {
                        type: "primary",
                        size: "small",
                        icon: "ios-search",
                        loading: this.loading,
                      },
                      style: { marginLeft: "8px" },
                      on: {
                        click: () => {
                          this.queryTrusteeRelation(params.index);
                        },
                      },
                    }),
                  ]
                ),
              ]
            );
          },
        },
        {
          title: "‰ø°Ë®óÈóú‰øÇ‰∫∫",
          key: "name",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.name, clearable: true },
              on: {
                input: (val) => {
                  params.row.name = val;
                },
              },
            });
          },
        },
        {
          title: "Êà∂Á±çÂú∞ÂùÄ",
          key: "registeredAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.registeredAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.registeredAddress = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∏Ä",
          key: "phone1",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone1, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone1 = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∫å",
          key: "phone2",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone2, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone2 = val;
                },
              },
            });
          },
        },
        {
          title: "ÂÇôË®ª",
          key: "remark",
          minWidth: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.remark, clearable: true },
              on: {
                input: (val) => {
                  params.row.remark = val;
                },
              },
            });
          },
        },
      ],
      trusteeDetailColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "Á∞°Á®±",
          key: "shortName",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h(
              "Select",
              {
                props: {
                  value: params.row.shortName,
                  placeholder: "Ë´ãÈÅ∏Âèñ",
                  transfer: true,
                },
                style: { width: "100%" },
                on: {
                  "on-change": (val) => {
                    params.row.shortName = val;
                  },
                },
              },
              [
                h("Option", { props: { value: "partyA" } }, "Áî≤Êñπ"),
                h("Option", { props: { value: "partyB" } }, "‰πôÊñπ"),
                h("Option", { props: { value: "partyC" } }, "‰∏ôÊñπ"),
              ]
            );
          },
        },
        {
          title: "Áµ±‰∏ÄÁ∑®Ëôü",
          key: "taxId",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.taxId,
                    clearable: true,
                  },
                  style: { flex: 1 },
                  on: {
                    input: (val) => {
                      params.row.taxId = val;
                    },
                  },
                }),
                h(
                  "Tooltip",
                  {
                    props: {
                      content: "Êü•Ë©¢",
                      transfer: true,
                    },
                  },
                  [
                    h("Button", {
                      props: {
                        type: "primary",
                        size: "small",
                        icon: "ios-search",
                        loading: this.loading,
                      },
                      style: { marginLeft: "8px" },
                      on: {
                        click: () => {
                          this.queryTrusteeDetail(params.index);
                        },
                      },
                    }),
                  ]
                ),
              ]
            );
          },
        },
        {
          title: "ÂèóË®ó‰∫∫",
          key: "name",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.name, clearable: true },
              on: {
                input: (val) => {
                  params.row.name = val;
                },
              },
            });
          },
        },
        {
          title: "‰ª£Ë°®‰∫∫",
          key: "representative",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.representative, clearable: true },
              on: {
                input: (val) => {
                  params.row.representative = val;
                },
              },
            });
          },
        },
        {
          title: "ÁôªË®òÂú∞ÂùÄ",
          key: "registeredAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.registeredAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.registeredAddress = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∏Ä",
          key: "phone1",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone1, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone1 = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∫å",
          key: "phone2",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone2, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone2 = val;
                },
              },
            });
          },
        },
      ],
      beneficiaryColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "Áµ±‰∏ÄÁ∑®Ëôü",
          key: "taxId",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.taxId,
                    clearable: true,
                  },
                  style: { flex: 1 },
                  on: {
                    input: (val) => {
                      params.row.taxId = val;
                    },
                  },
                }),
                h(
                  "Tooltip",
                  {
                    props: {
                      content: "Êü•Ë©¢",
                      transfer: true,
                    },
                  },
                  [
                    h("Button", {
                      props: {
                        type: "primary",
                        size: "small",
                        icon: "ios-search",
                        loading: this.loading,
                      },
                      style: { marginLeft: "8px" },
                      on: {
                        click: () => {
                          this.queryBeneficiary(params.index);
                        },
                      },
                    }),
                  ]
                ),
              ]
            );
          },
        },
        {
          title: "ÂèóÁõä‰∫∫",
          key: "name",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.name, clearable: true },
              on: {
                input: (val) => {
                  params.row.name = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∏Ä",
          key: "phone1",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone1, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone1 = val;
                },
              },
            });
          },
        },
        {
          title: "ÈõªË©±‰∫å",
          key: "phone2",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.phone2, clearable: true },
              on: {
                input: (val) => {
                  params.row.phone2 = val;
                },
              },
            });
          },
        },
        {
          title: "Êà∂Á±çÂú∞ÂùÄ",
          key: "registeredAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.registeredAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.registeredAddress = val;
                },
              },
            });
          },
        },
        {
          title: "ÈÄöË®äÂú∞ÂùÄ",
          key: "mailingAddress",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.mailingAddress, clearable: true },
              on: {
                input: (val) => {
                  params.row.mailingAddress = val;
                },
              },
            });
          },
        },
      ],
      landColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "ÂúüÂú∞ÂùêËêΩ",
          key: "location",
          minWidth: 400,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", gap: "8px", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.region,
                    placeholder: "Á≥ªÁµ±Â∏∂Âá∫Âú∞ÂçÄ",
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.region = val;
                    },
                  },
                }),
                h(
                  "Tooltip",
                  {
                    props: {
                      content: "Êü•Ë©¢",
                      transfer: true,
                    },
                  },
                  [
                    h(
                      "Button",
                      {
                        props: { size: "small" },
                        on: {
                          click: () => {
                            this.queryLandRegion(params.index);
                          },
                        },
                      },
                      "Êü•Ë©¢"
                    ),
                  ]
                ),
                h("Input", {
                  props: {
                    value: params.row.section,
                    placeholder: "Á≥ªÁµ±Â∏∂Âá∫Âú∞ÊÆµ",
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.section = val;
                    },
                  },
                }),
                h("span", "ÊÆµ"),
                h("Input", {
                  props: {
                    value: params.row.subsection,
                    placeholder: "Á≥ªÁµ±Â∏∂Âá∫Â∞èÊÆµ",
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.subsection = val;
                    },
                  },
                }),
                h("span", "Â∞èÊÆµ"),
                h("Input", {
                  props: {
                    value: params.row.landNo,
                    placeholder: "Ëº∏ÂÖ•Âú∞Ëôü",
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.landNo = val;
                    },
                  },
                }),
              ]
            );
          },
        },
        {
          title: "Ê¨äÂà©ÁØÑÂúç",
          key: "rightRange",
          width: 200,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", gap: "8px", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.rightRangeNumerator,
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.rightRangeNumerator = val;
                    },
                  },
                }),
                h("span", "ÂàÜ‰πã"),
                h("Input", {
                  props: {
                    value: params.row.rightRangeDenominator,
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.rightRangeDenominator = val;
                    },
                  },
                }),
              ]
            );
          },
        },
        {
          title: "ÂúüÂú∞Èù¢Á©ç(„é°)",
          key: "area",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.area || "100", clearable: true },
              on: {
                input: (val) => {
                  params.row.area = val;
                },
              },
            });
          },
        },
        {
          title: "ÊâÄÊúâÊ¨ä‰∫∫",
          key: "owner",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.owner, clearable: true },
              on: {
                input: (val) => {
                  params.row.owner = val;
                },
              },
            });
          },
        },
      ],
      buildingColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "Âª∫Áâ©ÂùêËêΩ",
          key: "location",
          minWidth: 300,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", gap: "8px", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.location,
                    clearable: true,
                  },
                  style: { flex: 3 },
                  on: {
                    input: (val) => {
                      params.row.location = val;
                    },
                  },
                }),
                h("span", "Âª∫Ëôü"),
                h("Input", {
                  props: {
                    value: params.row.buildingNo,
                    clearable: true,
                  },
                  style: { flex: 1 },
                  on: {
                    input: (val) => {
                      params.row.buildingNo = val;
                    },
                  },
                }),
              ]
            );
          },
        },
        {
          title: "Âª∫Áâ©ÈñÄÁâå",
          key: "address",
          minWidth: 250,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.address, clearable: true },
              on: {
                input: (val) => {
                  params.row.address = val;
                },
              },
            });
          },
        },
        {
          title: "ÊâÄÊúâÊ¨ä‰∫∫",
          key: "owner",
          minWidth: 200,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.owner, clearable: true },
              on: {
                input: (val) => {
                  params.row.owner = val;
                },
              },
            });
          },
        },
        {
          title: "Ê¨äÂà©ÁØÑÂúç",
          key: "rightRange",
          minWidth: 250,
          align: "center",
          render: (h, params) => {
            return h(
              "div",
              { style: { display: "flex", gap: "8px", alignItems: "center" } },
              [
                h("Input", {
                  props: {
                    value: params.row.rightRangeNumerator,
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.rightRangeNumerator = val;
                    },
                  },
                }),
                h("span", "ÂàÜ‰πã"),
                h("Input", {
                  props: {
                    value: params.row.rightRangeDenominator,
                    clearable: true,
                  },
                  style: { flex: "1" },
                  on: {
                    input: (val) => {
                      params.row.rightRangeDenominator = val;
                    },
                  },
                }),
              ]
            );
          },
        },
      ],
      feeColumns: [
        {
          title: "ÂäüËÉΩ",
          key: "action",
          width: 80,
          align: "center",
          slot: "action",
        },
        {
          title: "ÈñãËæ¶Ë≤ª/ÊâãÁ∫åË≤ª",
          key: "feeType",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "Select",
              {
                props: {
                  value: params.row.feeType,
                  placeholder: "Ë´ãÈÅ∏Âèñ",
                  transfer: true,
                },
                style: { width: "100%" },
                on: {
                  "on-change": (val) => {
                    params.row.feeType = val;
                  },
                },
              },
              [
                h("Option", { props: { value: "setup" } }, "ÈñãËæ¶Ë≤ª"),
                h("Option", { props: { value: "fee" } }, "ÊâãÁ∫åË≤ª"),
              ]
            );
          },
        },
        {
          title: "ÊâãÁ∫åË≤ªÈáëÈ°ça",
          key: "feeAmount",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.feeAmount, clearable: true },
              on: {
                input: (val) => {
                  params.row.feeAmount = val;
                },
              },
            });
          },
        },
        {
          title: "ÊâãÁ∫åË≤ªÁéá",
          key: "feeRate",
          width: 120,
          align: "center",
          render: (h, params) => {
            return h("Input", {
              props: { value: params.row.feeRate, clearable: true },
              on: {
                input: (val) => {
                  params.row.feeRate = val;
                },
              },
            });
          },
        },
        {
          title: "Êî∂Ë≤ªÊñπÂºèb",
          key: "paymentMethod",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h(
              "Select",
              {
                props: {
                  value: params.row.paymentMethod,
                  placeholder: "Ë´ãÈÅ∏Âèñ",
                  transfer: true,
                },
                style: { width: "100%" },
                on: {
                  "on-change": (val) => {
                    params.row.paymentMethod = val;
                  },
                },
              },
              [
                h("Option", { props: { value: "01" } }, "01‰∏ÄÊ¨°ÂÖ•Â∏≥"),
                h("Option", { props: { value: "02" } }, "02ÂàÜÊúü‰ªòÊ¨æ"),
                h("Option", { props: { value: "03" } }, "03ÊåâÊúàÊî∂Âèñ"),
              ]
            );
          },
        },
        {
          title: "ÊáâÊâ£Ê¨æÊó•",
          key: "deductDate",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("DatePicker", {
              props: {
                value: params.row.deductDate,
                type: "date",
                placeholder: "ÈÅ∏ÂèñÊó•Êúü",
                clearable: true,
                transfer: true,
              },
              style: { width: "100%" },
              model: {
                value: params.row.deductDate,
                callback: (val) => {
                  this.$set(params.row, "deductDate", val);
                },
                event: "on-change",
              },
            });
          },
        },
        {
          title: "ÂØ¶ÈöõÊâ£Ê¨æÊó•",
          key: "actualDeductDate",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("DatePicker", {
              props: {
                value: params.row.actualDeductDate,
                type: "date",
                placeholder: "ÈÅ∏ÂèñÊó•Êúü",
                clearable: true,
                transfer: true,
              },
              style: { width: "100%" },
              model: {
                value: params.row.actualDeductDate,
                callback: (val) => {
                  this.$set(params.row, "actualDeductDate", val);
                },
                event: "on-change",
              },
            });
          },
        },
        {
          title: "Êî§ÊèêËµ∑Êó•",
          key: "amortizeStartDate",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("DatePicker", {
              props: {
                value: params.row.amortizeStartDate,
                type: "date",
                placeholder: "ÈÅ∏ÂèñÊó•Êúü",
                clearable: true,
                transfer: true,
              },
              style: { width: "100%" },
              model: {
                value: params.row.amortizeStartDate,
                callback: (val) => {
                  this.$set(params.row, "amortizeStartDate", val);
                },
                event: "on-change",
              },
            });
          },
        },
        {
          title: "Êî§ÊèêËøÑÊó•",
          key: "amortizeEndDate",
          width: 150,
          align: "center",
          render: (h, params) => {
            return h("DatePicker", {
              props: {
                value: params.row.amortizeEndDate,
                type: "date",
                placeholder: "ÈÅ∏ÂèñÊó•Êúü",
                clearable: true,
                transfer: true,
              },
              style: { width: "100%" },
              model: {
                value: params.row.amortizeEndDate,
                callback: (val) => {
                  this.$set(params.row, "amortizeEndDate", val);
                },
                event: "on-change",
              },
            });
          },
        },
      ],
    };
  },
  watch: {
    value(val) {
      this.visible = val;
    },
    visible(val) {
      this.$emit("input", val);
      if (!val) {
        this.resetForm();
      }
    },
  },
  methods: {
    resetForm() {
      this.formData = {
        contractNoPrefix1: "",
        contractNoPrefix2: "",
        contractNoSuffix: "",
        department: "",
        referrerIdentity: "",
        referrer: "",
        handlerIdentity: "",
        handler: "",
        trustHandler: "",
        caseName: "",
        businessType: "",
        buildingType: "",
        caseAmount: "",
        contractDate: "",
        closeDate: "",
        trustAccountType: "+",
        trustAccount: "",
        durationStart: "",
        durationEnd: "",
        trustRegDate: "",
        trustCancelDate: "",
        cancelReason: "",
        returnBank: false,
        returnBankName: "",
        returnBranch: false,
        returnBranchName: "",
        returnAccount: false,
        returnAccountNo: "",
        clients: [],
        trusteeRelations: [],
        trustee: "‚óã‚óãÂïÜÊ•≠ÈäÄË°åËÇ°‰ªΩÊúâÈôêÂÖ¨Âè∏",
        trusteeType: "",
        trustType: "",
        trusteeDetails: [],
        beneficiaries: [],
        lands: [],
        buildings: [],
        remark: "",
        principalLand: "",
        fees: [],
        payer: "",
        requiredDocs: [],
        internalProfitRate: "",
        internalProfitBonus: "",
        externalProfitTarget: "",
        externalProfitRate: "",
        externalProfitBonus: "",
        externalProfitName: "",
        externalProfitAccountName: "",
        externalProfitBranchName: "",
        externalProfitBankName: "",
        externalProfitBankAccount: "",
      };
      this.$refs.contractForm.resetFields();
    },
    handleCancel() {
      this.visible = false;
    },
    handleSubmit() {
      this.$refs.contractForm.validate((valid) => {
        if (valid) {
          this.$Message.success("Â•ëÁ¥ÑÂª∫Ê™îÊàêÂäü");
          this.$emit("submit", this.formData);
          this.visible = false;
        } else {
          this.$Message.error("Ë´ãÂ°´ÂØ´ÂøÖÂ°´Ê¨Ñ‰Ωç");
        }
      });
    },
    // Êñ∞Â¢û/Âà™Èô§Ë°®Ê†ºË°å
    addClient() {
      this.formData.clients.push({
        shortName: "",
        identity: "",
        idNumber: "",
        clientName: "",
        representative: "",
        phone1: "",
        phone2: "",
        registeredAddress: "",
        mailingAddress: "",
        isBeneficiary: false,
      });
    },
    editClient(index) {
      this.$Message.info(`Á∑®ËºØÂßîË®ó‰∫∫Ôºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeClient(index) {
      this.formData.clients.splice(index, 1);
    },
    addTrusteeRelation() {
      this.formData.trusteeRelations.push({
        taxId: "",
        name: "",
        registeredAddress: "",
        phone1: "",
        phone2: "",
        remark: "",
      });
    },
    editTrusteeRelation(index) {
      this.$Message.info(`Á∑®ËºØ‰ø°Ë®óÈóú‰øÇ‰∫∫Ôºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeTrusteeRelation(index) {
      this.formData.trusteeRelations.splice(index, 1);
    },
    addTrusteeDetail() {
      this.formData.trusteeDetails.push({
        shortName: "",
        taxId: "",
        name: "",
        representative: "",
        registeredAddress: "",
        phone1: "",
        phone2: "",
      });
    },
    editTrusteeDetail(index) {
      this.$Message.info(`Á∑®ËºØÂèóË®ó‰∫∫ÊòéÁ¥∞Ôºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeTrusteeDetail(index) {
      this.formData.trusteeDetails.splice(index, 1);
    },
    addBeneficiary() {
      this.formData.beneficiaries.push({
        taxId: "",
        name: "",
        phone1: "",
        phone2: "",
        registeredAddress: "",
        mailingAddress: "",
      });
    },
    editBeneficiary(index) {
      this.$Message.info(`Á∑®ËºØÂèóÁõä‰∫∫Ôºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeBeneficiary(index) {
      this.formData.beneficiaries.splice(index, 1);
    },
    addLand() {
      this.formData.lands.push({
        region: "",
        section: "",
        subsection: "",
        landNo: "",
        rightRangeNumerator: "",
        rightRangeDenominator: "",
        area: "100",
        owner: "",
      });
    },
    editLand(index) {
      this.$Message.info(`Á∑®ËºØÂúüÂú∞Ë≥áÊñôÔºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeLand(index) {
      this.formData.lands.splice(index, 1);
    },
    addBuilding() {
      this.formData.buildings.push({
        location: "",
        buildingNo: "",
        address: "",
        owner: "",
        rightRangeNumerator: "",
        rightRangeDenominator: "",
      });
    },
    editBuilding(index) {
      this.$Message.info(`Á∑®ËºØÂª∫Áâ©Ë≥áÊñôÔºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeBuilding(index) {
      this.formData.buildings.splice(index, 1);
    },
    addFee() {
      this.formData.fees.push({
        feeType: "",
        feeAmount: "",
        feeRate: "",
        paymentMethod: "",
        deductDate: "",
        actualDeductDate: "",
        amortizeStartDate: "",
        amortizeEndDate: "",
      });
    },
    editFee(index) {
      this.$Message.info(`Á∑®ËºØ‰ø°Ë®óÊâãÁ∫åË≤ªÔºö${index}`);
      // ÈÄôË£°ÂèØ‰ª•ÂØ¶‰ΩúÁ∑®ËºØÂäüËÉΩ
    },
    removeFee(index) {
      this.formData.fees.splice(index, 1);
    },
    // Êü•Ë©¢ÊñπÊ≥ï
    queryClient(index) {
      this.$Message.info(
        `Êü•Ë©¢ÂßîË®ó‰∫∫Ôºö${this.formData.clients[index].clientName}`
      );
    },
    queryTrusteeRelation(index) {
      this.$Message.info(
        `Êü•Ë©¢‰ø°Ë®óÈóú‰øÇ‰∫∫Ôºö${this.formData.trusteeRelations[index].taxId}`
      );
    },
    queryTrusteeDetail(index) {
      this.$Message.info(
        `Êü•Ë©¢ÂèóË®ó‰∫∫ÊòéÁ¥∞Ôºö${this.formData.trusteeDetails[index].taxId}`
      );
    },
    queryBeneficiary(index) {
      this.$Message.info(
        `Êü•Ë©¢ÂèóÁõä‰∫∫Ôºö${this.formData.beneficiaries[index].taxId}`
      );
    },
    queryLandRegion(index) {
      this.$Message.info(`Êü•Ë©¢ÂúüÂú∞Âú∞ÂçÄÔºö${this.formData.lands[index].region}`);
    },
    queryExternalProfitName() {
      this.$Message.info(`Êü•Ë©¢ÂßìÂêçÔºö${this.formData.externalProfitName}`);
    },
  },
};
</script>

<style scoped>
.contract-form-container {
  max-height: calc(100vh - 200px);
  overflow-y: auto;
  padding: 10px;
}

.form-section {
  margin-bottom: 20px;
}

.section-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #1f2d3d;
}

.create-contract-modal {
  /deep/ .ivu-modal-body {
    max-height: calc(100vh - 200px);
    overflow-y: auto;
  }
}
</style>
